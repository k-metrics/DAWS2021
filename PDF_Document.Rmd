---
title: "PDF Document Template"
author: "Your Name, Licence"
date: "`r Sys.Date()`"
output:
  pdf_document: 
    include:
      in_header: latex/default_preamble.tex # 必要なパッケージやフォント設定
    latex_engine: xelatex
    number_sections: true
    fig_caption: yes
    keep_tex: yes
documentclass: bxjsarticle     # 章のないレポート用
# documentclass: bxjsreport      # 章のあるレポート用
# documentclass: bxjsslide       # スライド用
classoption: xelatex,ja=standard
always_allow_html: true        # 一種の呪文
link-citations: true           # 参考文献一覧へのリンクを有効化
colorlinks: true               # ハイパーリンクを色分けする
fig_crop: false
fontsize: 12pt                 # 本文のフォントサイズ
linestretch: 0.85              # 行間の指定
links-as-notes: true           # ハイパーリンク先を脚注に記載
mainfontoptions: "Scale=MatchUppercase"
monofontoptions: "Scale=0.8"   # 0.96がベストらしいが…よく分からない。
CJKoptions: "Scale=1.0"
---

```{r setup, include=FALSE}
require(tidyverse)
require(knitr)

knitr::opts_chunk$set(echo = TRUE,                 # Rコードを出力する
                      message = FALSE,             # Rのメッセージを抑止する
                      warning = FALSE,             # Rの警告を抑止する
                      fig_caption = TRUE,
                      fig.align = 'center',        # 図を中央揃えにする
                      attr.source='.numberLines'   # Rコードに行番号表示
                      )

if (knitr::is_latex_output()) {
  knitr::opts_chunk$set(dev = "cairo_pdf",         # 図の出力にPDFデバイスを使う
                        # fig.pos = "H",             # 図をその場で表示させる
                        tinytex.verbose = TRUE     # デバッグ用メッセージを出力
                        )
}
```


# 本テンプレートが必要とする環境

前提条件

* **`tidyverse`, `knitr`, `rmarkdown`**パッケージがインストールされている（**R** 4.x推奨）
)
* **RStudio**（v1.4推奨）

作成手順

1. **`tinytex`**パッケージをインストールする
1. `tinytex::install_tinytex()`で**tinytex**本体をインストールする
1. `tinytex::tlmgr_install("haranoaji")`で原の味フォントをインストールする
1. 本ドキュメントをknitする
    * 必要なTeXパッケージを自動的にインストール後、レンタリングします
    * TeXのパッケージが不足している場合はログを参考にインストールしてください
        * `tinytex::tlmgr_install("package")`
    * フォーマットを変更したい場合はYAMLの`documentclass`を変更してください

\newpage

## 日本語PDFの制限など
R MarkdownでPDFを作成するのは簡単ですが、日本語を含んだPDFを作成するには様々な知識が必要です。特にTeXの知識がないと日本語の表示すらできません。特にWindows環境は経験的に厄介ですので基本的にサポートはありません。  

* **tinytex**以外のTeX/LaTeXでは手動でパッケージをインストールする必要があります
    * 他のTeX/LaTeXでの動作は確認していません
* 本テンプレートは必要最低限の設定になっています
    * PDFのデフォルトとして図表は自動的に再配置されます
        * 固定したい場合は`setup`チャンク内の`fig.pos`オプションを試してみてください
* 見出しの日本語が化ける場合があります
    * 化けた場合は見出しを工夫してください（回避方法不明）
* Winodws環境はレンダリングに時間がかかります
* レンダリング時にワーニングが出ますがPDFは作成できます
    * Ubuntu環境とWindows環境で動作確認しています

enjoy!

\newpage

# R Markdown
This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars) %>% 
  knitr::kable(caption = "車のデータセット")
```

\newpage

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure, main = "日本語")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r, fig.cap="アイリスデータセット"}
iris %>% 
  ggplot2::ggplot(ggplot2::aes(x = Petal.Width, y = Petal.Length)) + 
    ggplot2::geom_point() + 
    ggplot2::geom_smooth(method = "lm") +
    ggplot2::labs(caption = "アイリスデータセット")
```

